# R04: Accessible Terminal UI Patterns Research
# Supporting Features: F008 (Accessibility), F014 (Bubble Tea TUI)
# Target Version: v0.2.0 Shield, v1.1.0 Bubble

metadata:
  id: "R04"
  name: "Accessible Terminal UI Patterns"
  folder: "04-accessibility"
  target_version: "0.2.0"
  priority: "P1"
  status: "complete"
  estimated_hours: 4
  actual_hours: 3.5
  assigned_to: "Agent"
  blocks_features:
    - "F008"
    - "F014"
  depends_on: []
  created: "2025-12-25"
  updated: "2025-12-26"
  started: "2025-12-26"
  completed: "2025-12-26"

objectives:
  primary:
    - goal: "Understand screen reader compatibility for terminal apps"
      description: |
        Research how VoiceOver, NVDA, and Orca interact with terminal applications.
        Determine what makes terminal output accessible.
      success_criteria: "Screen reader compatibility guidelines document"
      status: "complete"

    - goal: "Define WCAG 2.1 AA compliant color palettes for terminal"
      description: |
        Research minimum contrast ratios and create color palettes
        for light, dark, and high-contrast themes.
      success_criteria: "Three validated color palettes meeting WCAG AA"
      status: "complete"

    - goal: "Validate emoji + text pattern for status indicators"
      description: |
        Constitution requires status indicators combine emoji + text labels.
        Validate this approach works for accessibility.
      success_criteria: "Confirmed pattern or alternative recommendation"
      status: "complete"

    - goal: "Research keyboard-only navigation standards"
      description: |
        Determine best practices for keyboard navigation in TUI apps.
        Compare vim-style vs standard arrow key navigation.
      success_criteria: "Keyboard navigation specification"
      status: "complete"

  secondary:
    - goal: "Design --plain flag specification"
      description: "Output mode for scripts AND accessibility needs"
      success_criteria: "--plain flag specification"
      status: "complete"

key_questions:
  critical:
    - question: "How do screen readers handle terminal applications?"
      context: "Need to ensure SafeDownload is usable with assistive technology"
      answer: |
        Screen readers gather information from the terminal emulator through accessibility APIs,
        not directly from the application. Terminal emulator compatibility varies (e.g., xterm
        incompatible with Orca, GNOME Terminal compatible). Plain text mode is essential for
        screen reader users - auto-detect NO_COLOR, TERM=dumb, and provide --plain flag.
      confidence: "HIGH"
      sources:
        - "https://spot.pcc.edu/~mgoodman/DL/screen_readers_intro.php"
        - "https://seirdy.one/posts/2022/06/10/cli-best-practices/"

    - question: "What ANSI escape sequences work best for screen readers?"
      context: "Some escape sequences may interfere with screen readers"
      answer: |
        ANSI escape codes are problematic for screen readers. Best practice:
        1. Auto-detect and disable colors when NO_COLOR set or TERM=dumb
        2. Avoid animated spinners entirely - use text percentages
        3. Use plain text labels, not just styled output
        4. Pipe output through espeak-ng to test readability
      confidence: "HIGH"
      sources:
        - "https://no-color.org/"
        - "https://seirdy.one/posts/2022/06/10/cli-best-practices/"

  important:
    - question: "What are colorblind-safe color combinations for terminal?"
      context: "Avoid red/green only status; need alternatives"
      answer: |
        Avoid red/green pairs (deuteranopia affects 6% of males). Use:
        - Blue/Orange or Blue/Magenta instead
        - IBM's colorblind-safe palette: #648FFF, #DC267F, #FFB000, #FE6100, #785EF0
        - Always triple redundancy: emoji + text + optional color
        - Cyan for success, Magenta for error works across all colorblindness types
      confidence: "HIGH"
      sources:
        - "IBM Design Library Color-Blind Safe Palette"
        - "NCEAS Colorblind Safe Color Schemes guide"

    - question: "How to test accessibility without specialized hardware?"
      context: "Need practical testing approach for developers"
      answer: |
        1. macOS VoiceOver: Cmd+F5 to toggle, built into OS
        2. Linux Orca: sudo apt install orca, use with gnome-terminal
        3. espeak-ng: pipe output through TTS to verify readability
        4. Grayscale test: screenshot, convert to grayscale, verify distinction
        5. NO_COLOR=1 and TERM=dumb: verify plain output works
        6. Online tools: Coblis colorblind simulator
      confidence: "HIGH"
      sources:
        - "https://seirdy.one/posts/2022/06/10/cli-best-practices/"
        - "macOS/Linux documentation"

sources:
  documentation:
    - name: "WCAG 2.1 Quick Reference"
      url: "https://www.w3.org/WAI/WCAG21/quickref/"
      type: "official"
      relevance: "Accessibility standards reference"
      read_status: "not_read"
      notes: null

    - name: "Inclusive Components"
      url: "https://inclusive-components.design/"
      type: "reference"
      relevance: "General accessibility patterns"
      read_status: "not_read"
      notes: null

  libraries:
    - name: "termenv"
      url: "https://github.com/muesli/termenv"
      stars: 1600
      license: "MIT"
      relevance: "Terminal capability detection including color support"
      evaluation_status: "not_evaluated"
      evaluation_notes: null
      recommendation: null

constitution_alignment:
  principles:
    - id: "XI"
      name: "Accessibility"
      relevance: "Core focus of this research"
      compliance_notes: null

  gates:
    - gate: "Accessibility"
      requirement: "High-contrast mode support"
      research_relevance: "Define high-contrast palette"
      findings: null

    - gate: "Accessibility"
      requirement: "Status indicators combine emoji + text labels"
      research_relevance: "Validate this approach"
      findings: null

tasks:
  - id: "T001"
    description: "Research screen reader + terminal interaction"
    estimated_hours: 1
    actual_hours: 1
    status: "complete"

  - id: "T002"
    description: "Define WCAG AA color palettes (light, dark, high-contrast)"
    estimated_hours: 1
    actual_hours: 0.75
    status: "complete"

  - id: "T003"
    description: "Research colorblind-safe terminal colors"
    estimated_hours: 0.5
    actual_hours: 0.5
    status: "complete"

  - id: "T004"
    description: "Validate emoji + text pattern"
    estimated_hours: 0.5
    actual_hours: 0.25
    status: "complete"

  - id: "T005"
    description: "Define keyboard navigation specification"
    estimated_hours: 0.5
    actual_hours: 0.5
    status: "complete"

  - id: "T006"
    description: "Update dev/checklists/accessibility.md"
    estimated_hours: 0.5
    actual_hours: 0.5
    status: "complete"

findings:
  discoveries:
    - title: "NO_COLOR is industry standard"
      description: |
        The NO_COLOR environment variable (no-color.org) is widely adopted by
        major tools including npm, ripgrep, gh, bat, fzf, and many more.
        MUST be respected for accessibility compliance.
      impact: "HIGH"

    - title: "Terminal emulator compatibility varies"
      description: |
        xterm is NOT compatible with Orca screen reader, but GNOME Terminal IS,
        despite identical visual appearance. App developers cannot control this.
      impact: "MEDIUM"

    - title: "Animated spinners problematic"
      description: |
        Per accessibility experts, animated spinners are "extremely problematic
        for screenreaders". Use text percentages instead.
      impact: "HIGH"

    - title: "Triple redundancy pattern validated"
      description: |
        Constitution's emoji + text requirement is correct approach. Adding
        optional color provides triple redundancy (shape + text + color).
      impact: "HIGH"

  comparisons:
    - item: "vim-style vs arrow key navigation"
      recommendation: "Support both"
      rationale: |
        vim-style (j/k) is familiar to power users and consistent with Bubble Tea apps.
        Arrow keys are accessibility standard. Supporting both costs little and helps all.

    - item: "ANSI 16-color vs 256-color vs TrueColor"
      recommendation: "Use ANSI 16-color base"
      rationale: |
        ANSI 16 colors work on virtually all terminals. 256/TrueColor can be optional
        enhancements. termenv library can auto-detect support level.

decisions:
  - id: "D004"
    title: "Accessibility Implementation Approach"
    decision: |
      1. Implement --plain flag with auto-detection of NO_COLOR and TERM=dumb
      2. Use emoji + text + optional color (triple redundancy)
      3. Avoid red/green pairs; use cyan/magenta or blue/orange
      4. Support both vim-style and arrow key navigation
      5. Use termenv library for terminal capability detection
    rationale: |
      Aligns with constitution Principle XI, industry standards (NO_COLOR),
      and WCAG 2.1 AA requirements. Validated by accessibility research.
    status: "PROPOSED"

risks:
  - id: "RISK004-1"
    title: "Emoji rendering inconsistency"
    description: "Some terminals/fonts don't render emoji correctly"
    mitigation: "Provide ASCII fallback in plain mode ([OK], [ERROR], etc.)"
    severity: "LOW"

  - id: "RISK004-2"
    title: "Screen reader testing coverage"
    description: "Cannot test all screen reader + terminal combinations"
    mitigation: "Focus on VoiceOver (macOS) and Orca (Linux) for Tier 1 platforms"
    severity: "MEDIUM"

integration:
  feature_specs:
    - feature_id: "F008"
      feature_name: "Accessibility"
      updates_required:
        - section: "non_functional_requirements.accessibility"
          change: "Add specific color values and patterns"
          status: "pending"

log:
  entries:
    - date: "2025-12-26"
      action: "Research started"
      notes: "Began screen reader and WCAG research"
    - date: "2025-12-26"
      action: "Research completed"
      notes: "All objectives met, findings documented, decision proposed"

summary:
  executive_summary: |
    Research validates the constitution's accessibility approach (emoji + text indicators)
    and establishes comprehensive guidelines for terminal accessibility. Key findings:

    1. NO_COLOR environment variable is industry standard - MUST respect it
    2. Screen readers work through terminal emulators, not apps - plain text mode essential
    3. Avoid red/green color pairs; use blue/cyan/magenta alternatives
    4. Support both vim-style and arrow key navigation for maximum accessibility
    5. Use termenv library for Bubble Tea integration (capability detection)

    The constitution's requirement for "emoji + text labels" is validated as the correct
    approach, providing triple redundancy when combined with optional color.

  recommendations:
    - "Implement --plain flag with NO_COLOR auto-detection"
    - "Use ANSI 16-color base palette for maximum compatibility"
    - "Support both vim and arrow key navigation styles"
    - "Replace animated spinners with text progress indicators"
    - "Add ASCII fallbacks for all emoji in plain mode"
    - "Test with espeak-ng and VoiceOver before releases"

  open_questions: []

  overall_confidence: "HIGH"
